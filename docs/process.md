# 勤怠・シフト管理 SaaS — MVP 進捗管理（層別ラベル付き）

**目的:** Cursor エージェントが「バックエンド / API / UI」ごとにタスクを取得して効率的に実装できるようにする。

## 進捗サマリー

- **完了タスク**: 24/25 (96%)
- **backend実装完了**: T001〜T012 (12タスク)
- **UI実装完了**: T010a, T013, T014, T015, T019, T020, T021, T022, T023, T024, UI001, UI002 (12タスク)
- **改善・修正タスク**: 
  - ✅ タイムゾーン修正（JST対応）: シフト作成・更新時にJSTタイムゾーン情報を明示的に指定
  - ✅ ユーザー名分割: usersテーブルのnameカラムをlast_nameとfirst_nameに分割
  - ✅ カレンダーUI改善: 月ナビゲーションのUI改善（<>ボタン、今日ボタン、氏名スペース削除）
  - ✅ レイアウト再構成: app/layout.tsxをルートレイアウトのみに簡素化、NavigationWrapperをapp/app/layout.tsxに移動
  - ✅ ランディングページ改善: 店舗対応の強調を削除、シンプルで使いやすいを強調、主要機能セクションで複数店舗対応を明記
  - ✅ Analytics設定: Google Analytics (GA4)、Vercel Analytics、Vercel Speed Insightsを設定
- **残りタスク**: T016〜T018 (3タスク)
  - T016: Stripe課金管理
  - T017: 単体テスト
  - T018: 結合テスト

---

## 1. タスク一覧（層別ラベル付き）

| タスクID | カテゴリ | タスク内容 | 層 | 対象テーブル / モデル | 優先度 | 状態 | 備考 |
|----------|---------|-----------|----|---------------------|--------|------|------|
| T001 | 認証 | Supabase 認証連携 | backend | users | 高 | [x] | UUID を primary key として使用 |
| T002 | ユーザー管理 | ユーザー追加・編集・削除 | backend | company_users | 高 | [x] | 企業ごとの役割管理（admin/staff）、last_name/first_name分割対応 |
| T003 | 店舗所属管理 | スタッフの店舗所属管理 | backend | user_stores | 高 | [x] | 複数店舗対応、所属有効フラグ管理 |
| T004 | 企業管理 | 企業情報管理 | backend | companies | 高 | [x] | Stripe 顧客ID、プラン、ステータス管理 |
| T005 | 店舗管理 | 店舗情報管理 | backend | company_stores | 高 | [x] | 店舗名・住所、複数店舗対応 |
| T006 | 店舗設定 | 打刻承認設定管理 | backend | store_settings | 中 | [x] | approval_required フラグ管理 |
| T007 | シフト管理 | シフト作成・編集・削除 | backend | shifts | 高 | [x] | 出勤/退勤予定、複数店舗対応 |
| T008 | 休憩管理 | 休憩作成・編集・削除 | backend | shift_breaks | 高 | [x] | 1シフトに複数休憩対応 |
| T009 | シフトコピー | 日/週/月コピー機能 | backend | shift_copies | 中 | [x] | 上書き/スキップ管理 |
| T010 | 打刻管理 | 出勤・退勤・休憩打刻 | backend | clock_records | 高 | [x] | 打刻種類、選択時刻、実際時刻、方法、店舗情報 |
| T010a | 打刻画面 | 打刻画面作成（UI） | UI | clock_records | 高 | [x] | 出勤／退勤／休憩開始／休憩終了ボタン、時刻選択モーダル、店舗選択対応 |
| T011 | 承認機能 | 打刻承認管理 | backend / api | clock_records / store_settings | 中 | [x] | pending / approved / rejected 状態管理（backend実装済み） |
| T012 | 打刻編集 | 打刻編集機能（承認制適用） | backend / api | clock_records | 中 | [x] | 管理者が承認制の場合のみ反映（backend実装済み） |
| T013 | カレンダー表示 | スタッフ向けカレンダー | UI / api | shifts / clock_records | 高 | [x] | 自分のシフト・過去打刻履歴表示、日ごと色分け、複数店舗切替 |
| T014 | カレンダー表示 | 管理者向けカレンダー | UI / api | shifts / clock_records | 高 | [x] | 店舗全体・個人別勤務状況、日/週/月表示、未打刻者リスト、月ナビゲーションUI改善（<>ボタン、今日ボタン） |
| T015 | 勤務実績集計 | 日別・週別・月別勤務時間表示 | UI / api | shifts / clock_records | 中 | [x] | 予定時間との比較、店舗別集計 |
| T016 | 課金管理 | Stripe サブスク情報管理 | backend / api | subscriptions | 中 | [ ] | current_period_start/end, status, subscription_id |
| T019 | 管理画面 | 管理画面トップページ | UI | - | 高 | [x] | 各管理機能へのナビゲーション |
| T020 | 店舗管理画面 | 店舗追加・編集・削除画面 | UI / api | company_stores | 高 | [x] | 店舗一覧、追加・編集フォーム、削除機能 |
| T021 | スタッフ管理画面 | スタッフ追加・編集・削除、店舗所属設定画面 | UI / api | users / company_users / user_stores | 高 | [x] | スタッフ一覧、追加・編集フォーム、店舗所属設定、削除機能 |
| T022 | シフト管理画面 | シフト作成・編集・削除、コピー画面 | UI / api | shifts | 高 | [x] | シフト一覧、作成・編集フォーム、日/週/月コピー機能、削除機能、JSTタイムゾーン対応 |
| T023 | 設定画面 | 打刻承認設定などの店舗設定画面 | UI / api | store_settings | 中 | [x] | 店舗ごとの打刻承認設定ON/OFF |
| T024 | 打刻承認画面 | 打刻修正の承認・却下画面 | UI / api | clock_records | 中 | [x] | 承認待ちリスト、承認・却下機能 |
| T017 | テスト | 単体テスト実装 | backend / api / UI | すべて | 高 | [ ] | CRUD・打刻・承認・カレンダー表示 |
| T018 | テスト | 結合テスト実装 | backend / api / UI | すべて | 高 | [ ] | MVPとして必要な機能の全体確認 |
| UI001 | UI改善 | モダンなデザイン適用・共通ナビゲーション | UI | レイアウト | 中 | [x] | デザインのモダン化、全ページでナビゲーション表示、ブルー系テーマカラー適用、管理者判定によるUI制御 |
| UI002 | ランディングページ | ランディングページ作成 | UI | ランディング | 中 | [x] | サービス紹介、機能説明、CTAボタン、モダンなデザイン、レイアウト再構成対応 |

---

## 2. 作業の進め方（Cursor向け）

1. ✅ **backend タスク**（T001〜T010, T011, T012）を実装 - **完了**  
2. ⏳ **api タスク**（T011, T012, T013〜T016）でフロントとの通信設計・エンドポイント実装 - **進行中**  
3. ⏳ **UI タスク**（T010a✅, T013✅, T014✅, T015✅）で画面設計・表示ロジック実装 - **進行中**  
4. ✅ **UI改善タスク**（UI001）でデザインのモダン化・共通ナビゲーション実装 - **完了**  
5. ✅ **ランディングページ**（UI002）でサービス紹介ページ作成 - **完了**  
6. ⏳ **テスト**（T017, T018）で単体・結合テストを実施 - **未着手**  

### 次の優先タスク

1. **T016**: Stripe課金管理（backend / api）
2. **T017**: 単体テスト実装（backend / api / UI）
3. **T018**: 結合テスト実装（backend / api / UI）

> 💡 層ごとにラベルがあるので、Cursor は優先順や担当範囲を明確にしてタスクを pull 可能
